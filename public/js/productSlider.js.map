{"version":3,"names":[],"mappings":"","sources":["productSlider.js"],"sourcesContent":["$(document).ready(function () {\r\n    var defaultImage = 'http://cdn.strikepro.ru/default_group.png';\r\n    var Body = $(\"body\");\r\n    var characteristicsList = $('.characteristics__list');\r\n    var GalleryWrap = $('.colorTable__gallery--wrapper');\r\n    var galleryPhotoList = $('.variation__list');\r\n    var GalleryMainPhoto = $('.colorTable__gallery--img');\r\n\r\n    var colorTable = $('.colorTable');\r\n    var colorTableItem = [];\r\n    var sliderItem = [];\r\n    var GlideSlides = $('.glide__slides');\r\n    var GlideSlidesList = [];\r\n\r\n    var IndexCurrentSlide = 0;\r\n    var $panzoom;\r\n    var GlideSlider = new Glide('.glide', {\r\n        startAt: IndexCurrentSlide,\r\n        perView: 6,\r\n        type: 'slider',\r\n        breakpoints: {\r\n            1920: {\r\n                perView: 6\r\n            },\r\n            1600: {\r\n                perView: 5\r\n            },\r\n            1024: {\r\n                perView: 4\r\n            },\r\n            768: {\r\n                perView: 3\r\n            },\r\n        }\r\n    });\r\n\r\n    var GlideInit = false;\r\n\r\n\r\n    /** @desc рендер списка вариантов артикла, принимает на вход массив */\r\n    function colorTableItemRender(id, image, data, classWrapper) {\r\n        var title = '';\r\n        var ultraviolet = false;\r\n        var luminous = false;\r\n        for (var i = 0; i < data.features.length; i++) {\r\n            if (data.features[i].title === 'Код цвета') {\r\n                title = data.features[i].pivot.value\r\n            }\r\n            if (data.features[i].title === \"Светящийся\") {\r\n                console.log(\"Светящийся\", data.features[i].pivot.value === 'Да');\r\n                luminous = data.features[i].pivot.value === 'Да';\r\n            }\r\n            if (data.features[i].title === \"Ультрафиолет\") {\r\n                ultraviolet = data.features[i].pivot.value === 'Да';\r\n            }\r\n        }\r\n\r\n\r\n        return ('<div class=\"colorTable__item ' + classWrapper + '\" id=\"' + id + '\">' +\r\n            '<div class=\"colorTable__img\">' +\r\n            '<img src=\"' + image + '\" alt=\"\">' +\r\n            (ultraviolet ? '<div class=\"colorTable__marker colorTable__marker--ultraviolet\"></div>' : '') +\r\n            (luminous ? '<div class=\"colorTable__marker colorTable__marker--luminous\"></div>' : '') +\r\n            '</div>' +\r\n            '<span>' + title + '</span>' +\r\n            '</div>')\r\n    }\r\n\r\n    /** @desc рендер списка характеристик, принимает на вход массив */\r\n    function descriptionRender(array) {\r\n        var features = [];\r\n        $(characteristicsList).empty();\r\n        for (var i = 0; i < array.length; i++) {\r\n            if (parseInt(array[i].is_visible) === 1) {\r\n                var feature = '<li class=\"characteristics__item\">' +\r\n                    '<span class=\"characteristics__title\">' + array[i].title + '</span>' +\r\n                    '<span class=\"characteristics__desc\">' + array[i].pivot.value + '</span>' +\r\n                    '</li>';\r\n                features.push(feature);\r\n            }\r\n        }\r\n        $(characteristicsList).append(features);\r\n    }\r\n\r\n    /** @desc инициализация списка харктеристик по id артикла */\r\n    function initDescription(id) {\r\n        for (var i = 0; i < articles.length; i++) {\r\n            if (articles[i].id === parseInt(id)) {\r\n                console.log(id);\r\n                console.log(articles[i].features);\r\n                descriptionRender(articles[i].features);\r\n            }\r\n        }\r\n    }\r\n\r\n    /** @desc рендер списка артиклей в слайдере */\r\n    function sliderItemRender(image, id, data, index) {\r\n        console.log(index);\r\n        var title = '';\r\n        var ultraviolet = false;\r\n        var luminous = false;\r\n        for (var i = 0; i < data.features.length; i++) {\r\n            if (data.features[i].title === 'Код цвета') {\r\n                title = data.features[i].pivot.value\r\n            }\r\n            if (data.features[i].title === \"Светящийся\") {\r\n                console.log(\"Светящийся\", data.features[i].pivot.value === 'Да');\r\n                luminous = data.features[i].pivot.value === 'Да';\r\n            }\r\n            if (data.features[i].title === \"Ультрафиолет\") {\r\n                ultraviolet = data.features[i].pivot.value === 'Да';\r\n            }\r\n        }\r\n        return (\r\n            '<li data-key=\"' + index + '\" class=\"slider__item glide__slide\" id=\"' + id + '\"> ' +\r\n            '<a href=\"#!\"  class=\"slider__link\" >' +\r\n            '<img src=\"' + image + '\" />' +\r\n            (ultraviolet ? '<div class=\"colorTable__marker colorTable__marker--ultraviolet\"></div>' : '') +\r\n            (luminous ? '<div class=\"colorTable__marker colorTable__marker--luminous\"></div>' : '') +\r\n            '</a>' +\r\n            '<span class=\"slider__item-title\">' + title + '</span> ' +\r\n            '</li>'\r\n        )\r\n    }\r\n\r\n    function CreateArticlesTable() {\r\n        try {\r\n            $(colorTable).empty();\r\n            $(colorTable).after(\"<div class='colorTable _mobile'></div>\");\r\n\r\n            for (var i = 0; i < articles.length; i++) {\r\n                if (articles[i].logo) {\r\n                    colorTableItem.push(colorTableItemRender(articles[i].id, articles[i].logo.thumb_url ? articles[i].logo.thumb_url : defaultImage, articles[i]));\r\n                } else {\r\n                    colorTableItem.push(colorTableItemRender(articles[i].id, defaultImage, articles[i]));\r\n                }\r\n            }\r\n            $(colorTable).append(colorTableItem);\r\n            $('.colorTable._mobile').append(colorTableItem);\r\n\r\n            $('.colorTable .colorTable__item').on('click', initGallery);\r\n\r\n        } catch (err) {\r\n            throw new Error(err);\r\n        }\r\n    }\r\n\r\n    /** @desc смена главного изображения по id артикла */\r\n    function initGalleryMainPhoto(id) {\r\n        var ultraviolet = false;\r\n        var luminous = false;\r\n        for (var i = 0; i < articles.length; i++) {\r\n            if (articles[i].id === parseInt(id)) {\r\n                for (var a = 0; a < articles[i].features.length; a++) {\r\n                    if (articles[i].features[a].title === \"Светящийся\") {\r\n                        console.log(\"Светящийся\", articles[i].features[a].pivot.value === 'Да');\r\n                        luminous = articles[i].features[a].pivot.value === 'Да';\r\n                    }\r\n                    if (articles[i].features[a].title === \"Ультрафиолет\") {\r\n                        ultraviolet = articles[i].features[a].pivot.value === 'Да';\r\n                    }\r\n                }\r\n                $(GalleryMainPhoto).empty();\r\n                console.log('articles[i]: ', articles[i]);\r\n                if (articles[i].logo) {\r\n\r\n                    $(GalleryMainPhoto).append('<img src=\"' + articles[i].logo.original_url + '\" alt=\"\">');\r\n\r\n                } else {\r\n                    $(GalleryMainPhoto).append('<img src=\"' + defaultImage + '\" alt=\"\">');\r\n\r\n                }\r\n\r\n                if (luminous) {\r\n                    $(GalleryMainPhoto).append('<div class=\"colorTable__gallery__marker colorTable__gallery__marker--luminous\"></div>');\r\n                }\r\n                if (ultraviolet) {\r\n                    $(GalleryMainPhoto).append('<div class=\"colorTable__gallery__marker colorTable__gallery__marker--ultraviolet\"></div>');\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /** @desc рендер списка вариантов артикла, принимает на вход массив */\r\n    function gelleryPhotoRender(Array) {\r\n        var photos = [];\r\n        var array = Array;\r\n\r\n        if (array === undefined) {\r\n            return null;\r\n        }\r\n        if (array.length > 1) {\r\n            for (var i = 0; i < array.length; i++) {\r\n                var photo = '<li class=\"variation__item\">' +\r\n                    '<img id=\"' + array[i].id + '\" src=\"' + array[i].thumb_url + '\" alt=\"\">' +\r\n                    '</li>';\r\n                photos.push(photo);\r\n            }\r\n            $(galleryPhotoList).append(photos);\r\n            $('.colorTable__gallery--variation').addClass('active');\r\n\r\n            $('.variation__item img').on('click', function () {\r\n                initGalleryMainPhoto($(this).attr('id'));\r\n\r\n                $(GalleryMainPhoto).css({\r\n                    'transform': 'none'\r\n                })\r\n            })\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /** @desc смена главного изображения по id артикла*/\r\n    function initPhotos(id) {\r\n        $(galleryPhotoList).empty();\r\n        for (var i = 0; i < articles.length; i++) {\r\n            if (articles[i].id === parseInt(id)) {\r\n                initGalleryMainPhoto(articles[i].id);\r\n                console.log(articles[i]);\r\n                gelleryPhotoRender(articles[i].head_images);\r\n            }\r\n        }\r\n    }\r\n\r\n    function initGallery() {\r\n        var windowSize = window.innerWidth;\r\n        if (windowSize >= 768) {\r\n            $(GalleryWrap).show();\r\n            $(Body).css({\r\n                \"overflow\": \"hidden\"\r\n            });\r\n\r\n\r\n            if (!GlideInit) {\r\n\r\n                GlideSlider.mount();\r\n                GlideInit = true;\r\n\r\n                GlideSlider.on('run', function (event) {\r\n                    console.log('run: ', event);\r\n                    switch (event.direction) {\r\n                        case('>'): {\r\n                            if (IndexCurrentSlide === $('.glide__slides')[\"0\"].children.length - 1) {\r\n                                IndexCurrentSlide = 0;\r\n                            } else {\r\n                                IndexCurrentSlide += 1;\r\n                            }\r\n                            onActivePhoto($($('.glide__slides')[\"0\"].children[IndexCurrentSlide]).attr('id'));\r\n                            break\r\n                        }\r\n                        case('<'): {\r\n                            if (IndexCurrentSlide === 0) {\r\n                                IndexCurrentSlide = $('.glide__slides')[\"0\"].children.length - 1;\r\n                            } else {\r\n                                IndexCurrentSlide -= 1;\r\n                            }\r\n                            onActivePhoto($($('.glide__slides')[\"0\"].children[IndexCurrentSlide]).attr('id'));\r\n\r\n                            break\r\n                        }\r\n                    }\r\n                })\r\n\r\n                $(\".slider__item\").on('click', function () {\r\n                    IndexCurrentSlide = $('.slider__item').index(this);\r\n                    GlideSlider.go('=' + IndexCurrentSlide);\r\n                    onActivePhoto($(this).attr('id'));\r\n                });\r\n\r\n            }\r\n            IndexCurrentSlide = $('.colorTable__item').index(this);\r\n            GlideSlider.go('=' + IndexCurrentSlide);\r\n\r\n\r\n            return initSlider(this);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /** @desc инициализация слайдера */\r\n    function initSlider(event) {\r\n        sliderItem = [];\r\n        console.log($(event));\r\n        initDescription($(event).attr('id'));\r\n        initPhotos($(event).attr('id'));\r\n        PanZoomInit();\r\n    }\r\n\r\n    /** @desc активация элемента списка по id артикла */\r\n    function onActivePhoto(id) {\r\n        initDescription(id);\r\n        initPhotos(id);\r\n\r\n        $(GalleryMainPhoto).css({\r\n            'transform': 'none'\r\n        });\r\n        PanZoomInit();\r\n    }\r\n\r\n    function CreateSliderItems() {\r\n        try {\r\n            var windowSize = window.innerWidth;\r\n            if (windowSize >= 768) {\r\n                $(GlideSlides).empty();\r\n\r\n                for (var i = 0; i < articles.length; i++) {\r\n                    if (articles[i].logo) {\r\n                        GlideSlidesList.push(sliderItemRender(articles[i].logo.thumb_url, articles[i].id, articles[i], i))\r\n                    } else {\r\n                        GlideSlidesList.push(sliderItemRender(defaultImage, articles[i].id, articles[i], i))\r\n                    }\r\n                }\r\n                $(GlideSlides).append(GlideSlidesList);\r\n\r\n            }\r\n        } catch (err) {\r\n            throw new Error(err);\r\n        }\r\n\r\n    }\r\n\r\n    function PanZoomInit() {\r\n        $panzoom = $(GalleryMainPhoto).find('img').panzoom();\r\n        $panzoom.parent().on('mousewheel.focal', function (e) {\r\n            e.preventDefault();\r\n            var delta = e.delta || e.originalEvent.wheelDelta;\r\n            var zoomOut = delta ? delta < 0 : e.originalEvent.deltaY > 0;\r\n            $panzoom.panzoom('zoom', zoomOut, {\r\n                increment: 0.1,\r\n                animate: false,\r\n                focal: e,\r\n                minScale: 1\r\n            });\r\n        });\r\n    }\r\n\r\n\r\n    function colorTable_item_slider() {\r\n        var colorTableItemMobile = $('.colorTable._mobile .colorTable__item');\r\n        var colorTableItemMobileLength = colorTableItemMobile.length;\r\n        for (var i = 0; i < colorTableItemMobileLength; i++) {\r\n\r\n\r\n            var slides = [];\r\n            var classNav = \".custom-navigation-\" + i + \" a\";\r\n            var photos = articles[i].head_images;\r\n            var photosLength = photos.length;\r\n            console.log('articles[i]', articles[i]);\r\n            if (photosLength < 2) continue;\r\n\r\n            var sliderWrap = document.createElement('div'),\r\n                sliderList = document.createElement('ul');\r\n            $(sliderWrap).addClass('slider-' + i);\r\n            $(sliderList).addClass('slides');\r\n            for (var a = 0; a < photosLength; a++) {\r\n                var li = document.createElement('li'),\r\n                    img = document.createElement('img'),\r\n                    span = document.createElement('span');\r\n                $(span).text(photos[a].title);\r\n                $(img).attr('src', photos[a].original_url);\r\n                $(li).append(img);\r\n                $(li).append(span);\r\n                slides.push(li)\r\n            }\r\n\r\n            $(sliderList).append(slides);\r\n            $(sliderWrap).append(sliderList);\r\n            $(sliderWrap).append('<div class=\"flex-direction-nav ' + \"custom-navigation-\" + i + '\">' +\r\n                '<a href=\"!#\" class=\"flex-prev\">' +\r\n                '<svg><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#svg_arrow\" class=\"caret__arrow\"></use></svg>' +\r\n                '</a>' +\r\n                '<a href=\"!#\" class=\"flex-next\">' +\r\n                '<svg><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#svg_arrow\" class=\"caret__arrow\"></use></svg>' +\r\n                '</a>' +\r\n                '</div>');\r\n\r\n\r\n            $(colorTableItemMobile[i]).empty();\r\n            $(colorTableItemMobile[i]).append(sliderWrap);\r\n\r\n            $(sliderWrap).flexslider({\r\n                animation: \"slide\",\r\n                slideshow: false,\r\n                touch: true,\r\n                directionNav: true,\r\n                controlNav: false,\r\n                customDirectionNav: $(classNav)\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    try {\r\n\r\n        CreateArticlesTable();\r\n\r\n        CreateSliderItems();\r\n\r\n\r\n        colorTable_item_slider()\r\n    } catch (err) {\r\n        console.log(err)\r\n    }\r\n\r\n\r\n});\r\n\r\n// http://webcareer.ru/menyaem-aktivnyj-punkt-menyu-pri-prokrutke-stranicy.html\r\n// http://jsfiddle.net/mekwall/up4nu/\r\n\r\n$(document).ready(function () {\r\n\r\n    // js-btn3D\r\n    if(window.real3DConfig && window.real3DConfig.images){\r\n        $(\".js-btn3D\").on(\"click\", function () {\r\n            var img3D = $('#reel-image');\r\n            $(img3D).reel({\r\n                loops: false,\r\n                speed: 0,\r\n                frames: 32,\r\n                revolution: 100,\r\n                images: window.real3DConfig ? window.real3DConfig.images : '',\r\n            });\r\n\r\n            $(\".img_2d\").hide();\r\n            $('#reel-image-reel').show();\r\n            $(img3D).show()\r\n        });\r\n    } else {\r\n        $('.js-btn3D').hide();\r\n    }\r\n\r\n\r\n    $(\".product__sliderImg ul li a\").on('click', function (event) {\r\n\r\n        var img2D = $(\".img_2d\");\r\n        var img3D = $('#reel-image');\r\n        event.preventDefault();\r\n        $(img2D).show();\r\n        $(img2D).attr(\"src\", $(this).attr(\"href\"));\r\n        $(img3D).hide();\r\n        $('#reel-image-reel').hide();\r\n    });\r\n    // $(window).resize(function () {\r\n    //     var k = 500 / 304,\r\n    //         productStand = $('.product__stand'),\r\n    //         w = $(document).width();\r\n    //\r\n    //     if (w < 500) {\r\n    //         $(productStand).height($(productStand).width() / k);\r\n    //     } else {\r\n    //         $(productStand).height('auto');\r\n    //     }\r\n    // });\r\n\r\n\r\n    /** @desc ШАПКА СТРАНИЦЫ ПРОДУКТА */\r\n    var HeaderProductWrapper = $('.header-product'),\r\n        HeaderProductTitle = $('.header-product__title'),\r\n        HeaderProductImage = $('.header-product__image img'),\r\n        HeaderProductNav = $('.header-product__nav'),\r\n        SectionTitleList = $('h4.title__xs'),\r\n        HeaderProductMenuList = [];\r\n\r\n    function toggleMenuLink() {\r\n        var lastId,\r\n            topMenu = $('.header-product__nav'),\r\n            topMenuHeight = $(topMenu).outerHeight() + 15,\r\n            // All list items\r\n            menuItems = $(topMenu).find(\"a\"),\r\n            // Anchors corresponding to menu items\r\n            scrollItems = $(menuItems).map(function () {\r\n                var item = $(this.hash);\r\n                if (item.length) {\r\n                    return item;\r\n                }\r\n            });\r\n\r\n// Bind click handler to menu items\r\n// so we can get a fancy scroll animation\r\n        $(menuItems).click(function (e) {\r\n            var href = $(this.hash);\r\n            offsetTop = href === \"#\" ? 0 : $(href).offset().top - topMenuHeight + 1;\r\n            $('html, body').stop().animate({\r\n                scrollTop: offsetTop\r\n            }, 300);\r\n            e.preventDefault();\r\n        });\r\n\r\n// Bind to scroll\r\n        $(window).scroll(function () {\r\n            // Get container scroll position\r\n            var fromTop = $(this).scrollTop() + topMenuHeight;\r\n            // Get id of current scroll item\r\n            var cur = $(scrollItems).map(function () {\r\n                if ($(this).offset().top < fromTop)\r\n                    return this;\r\n            });\r\n            // Get the id of the current element\r\n            cur = cur[cur.length - 1];\r\n\r\n            var id = cur && cur.length ? cur[0].id : \"\";\r\n            if (lastId !== id) {\r\n                lastId = id;\r\n                $(menuItems).parent().removeClass(\"active\");\r\n                $(\"[href='#\" + lastId + \"']\").parent('.header-product__item').addClass(\"active\");\r\n            }\r\n            HeaderProductToggle();\r\n        });\r\n    }\r\n\r\n    function renderMenuItem(link, content) {\r\n        return ('<li class=\"header-product__item\"><a href=\"#' + link + '\" class=\"header-product__link\">' + content + '</a></li>')\r\n    }\r\n\r\n    function init() {\r\n        $(HeaderProductNav).empty();\r\n        HeaderProductMenuList.push(renderMenuItem('main-image', 'Изображение'));\r\n        $(SectionTitleList).each(function (index, element) {\r\n            var id = 'product-section-id-' + index,\r\n                content = $(element).text();\r\n            $(element).attr(\"id\", id);\r\n            HeaderProductMenuList.push(renderMenuItem(id, content));\r\n        });\r\n        $(HeaderProductNav).append(HeaderProductMenuList);\r\n        $(HeaderProductImage).attr('src', $('.product__stand--img .img_2d').attr('src'));\r\n        $(HeaderProductTitle).text($('.product__title h1').text());\r\n\r\n        //TODO: Инициализация обработчика скрола\r\n        toggleMenuLink()\r\n\r\n    }\r\n\r\n\r\n    init();\r\n\r\n    function HeaderProductToggle() {\r\n        if (screen.width > 1023) {\r\n            if ($(\".img_2d\").offset().top < window.scrollY) {\r\n\r\n                $('.header__top').css({top: '-150px'});\r\n                $('.header-product').css({top: '0'});\r\n            } else {\r\n                $('.header__top').css({top: '0'});\r\n                $('.header-product').css({top: '-150px'});\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n});\r\n\r\n\r\n//TODO: Gallery\r\n$(document).ready(function () {\r\n    try {\r\n        $('.product-gallery_list').magnificPopup({\r\n            delegate: 'li a',\r\n            type: 'image',\r\n            tLoading: 'Loading image #%curr%...',\r\n            mainClass: 'mfp-img-mobile',\r\n            gallery: {\r\n                enabled: true,\r\n                arrowMarkup: '<button title=\"%title%\" type=\"button\" onclick=\"event.stopPropagation()\" class=\"product-gallery_arrow mfp-arrow mfp-arrow-%dir% mfp-prevent-close product-gallery_arrow-%dir%\"><svg ><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#svg_arrow\" class=\"arrow\"></use></svg></button>', // markup of an arrow button\r\n                tCounter: '%curr% из %total%',\r\n                navigateByImgClick: true,\r\n                preload: [0, 1] // Will preload 0 - before current, and 1 after the current image\r\n            },\r\n            image: {\r\n                titleSrc: function (item) {\r\n                    return item.el.attr('title');\r\n                }\r\n            },\r\n            zoom: {\r\n                enabled: true,\r\n                duration: 200, // don't foget to change the duration also in CSS\r\n                opener: function (element) {\r\n                    return element.find('img');\r\n                }\r\n            }\r\n        });\r\n    } catch (err) {\r\n        throw new Error(err);\r\n\r\n    }\r\n\r\n});\r\n"],"file":"productSlider.js"}