{"version":3,"names":[],"mappings":"","sources":["productSlider.js"],"sourcesContent":["$(document).ready(function () {\r\n    var body = $(\"body\");\r\n\r\n    var colorTable = $('.colorTable'),\r\n        characteristicsList = $('.characteristics__list'),\r\n        slideContainer = $(\".slider__wrap\"),\r\n        galleryWrap = $('.colorTable__gallery--wrapper'),\r\n        gallerySliderWrap = $('.colorTable__gallery--slider'),\r\n        galleryPhotoList = $('.variation__list'),\r\n        galleryMainPhoto = $('.colorTable__gallery--img img'),\r\n        galleryMainTitle = $('.colorTable__gallery--title');\r\n\r\n    var colorTableItem = [],\r\n        sliderItem = [],\r\n        currentPhoto = [];\r\n\r\n    var currentPosition = 0,\r\n        widthStep,\r\n        maxStep;\r\n\r\n    // функции генераторы разметки\r\n\r\n    function colorTableItemRender(id, image, data) {\r\n        var title = '';\r\n        for (var i = 0; i < data.features.length; i++) {\r\n            if (data.features[i].title === 'Код цвета') {\r\n                title = data.features[i].pivot.value\r\n            }\r\n        }\r\n        return ('<div class=\"colorTable__item\" id=\"' + id + '\">' +\r\n            '<img src=\"' + image + '\" alt=\"\">' +\r\n            '<span>' + title + '</span>' +\r\n            '</div>')\r\n    }\r\n\r\n    function descriptionRender(array) {\r\n        var features = [];\r\n        $(characteristicsList).empty();\r\n        for (var i = 0; i < array.length; i++) {\r\n            var feature = '<li class=\"characteristics__item\">' +\r\n                '<span class=\"characteristics__title\">' + array[i].title + '</span>' +\r\n                '<span class=\"characteristics__desc\">' + array[i].pivot.value + '</span>' +\r\n                '</li>';\r\n            features.push(feature);\r\n        }\r\n        $(characteristicsList).append(features);\r\n    }\r\n\r\n    function sliderItemRender(image, id, data) {\r\n        var title = '';\r\n        for (var i = 0; i < data.features.length; i++) {\r\n            if (data.features[i].title === 'Код цвета') {\r\n                title = data.features[i].pivot.value\r\n            }\r\n        }\r\n        return (\r\n            '<li  class=\"slider__item\" id=\"' + id + '\"> <a href=\"#!\"  class=\"slider__link\" ><img src=\"' + image + '\" /></a><span class=\"slider__item-title\">' + title + '</span> </li>'\r\n        )\r\n    }\r\n\r\n    function gelleryPhotoRender(Array) {\r\n        var photos = [];\r\n        var array = Array;\r\n\r\n        if (array === undefined) {\r\n            console.log(array);\r\n            // initGalleryMainPhoto(array[i].id);\r\n            return null;\r\n        }\r\n        if (array.length > 1) {\r\n            for (var i = 0; i < array.length; i++) {\r\n                var photo = '<li class=\"variation__item\">' +\r\n                    '<img id=\"' + array[i].id + '\" src=\"' + array[i].thumb_url + '\" alt=\"\">' +\r\n                    '</li>';\r\n                photos.push(photo);\r\n                // if (i === 0) {\r\n                //     initGalleryMainPhoto(array[i].id);\r\n                // }\r\n            }\r\n            $(galleryPhotoList).append(photos);\r\n            $('.colorTable__gallery--variation').addClass('active');\r\n\r\n            $('.variation__item img').on('click', function () {\r\n                // initGalleryMainPhoto($(this).attr('id'));\r\n\r\n                for (var i = 0; i < array.length; i++) {\r\n                    if (array[i].id === parseInt($(this).attr('id'))) {\r\n\r\n                        $(galleryMainPhoto).attr('src', array[i].original_url);\r\n                        if (array[i].title) {\r\n                            $(galleryMainTitle).text(array[i].title);\r\n                        }\r\n                    }\r\n                }\r\n\r\n\r\n                $(galleryMainPhoto).css({\r\n                    'transform': 'none'\r\n                })\r\n            })\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    // функции движения слайдера\r\n\r\n    function leftMove(event) {\r\n        console.log(event.type);\r\n        var step = event.type === 'click' ? 6 : 1;\r\n        if (sliderItem.length <= 6) {\r\n            return\r\n        }\r\n\r\n        if (currentPosition <= 0) {\r\n            currentPosition = 0;\r\n            $(slideContainer).css({\r\n                \"transform\": \"translateX(-\" + currentPosition + \"px)\"\r\n            });\r\n\r\n            return;\r\n        }\r\n\r\n        currentPosition -= parseFloat(widthStep * step);\r\n        if (currentPosition <= 0) {\r\n            currentPosition = 0;\r\n            $(slideContainer).css({\r\n                \"transform\": \"translateX(-\" + currentPosition + \"px)\"\r\n            });\r\n\r\n            return;\r\n        }\r\n        $(slideContainer).css({\r\n            \"transform\": \"translateX(-\" + currentPosition + \"px)\"\r\n        });\r\n    }\r\n\r\n    function rightMove(event) {\r\n        var step = event.type === 'click' ? 6 : 1;\r\n        if (sliderItem.length <= 6) {\r\n            return\r\n        }\r\n        if (Math.round(parseFloat(currentPosition)) === Math.round(parseFloat(maxStep))) {\r\n            currentPosition = parseFloat(maxStep);\r\n            $(slideContainer).css({\r\n                \"transform\": \"translateX(-\" + currentPosition + \"px)\"\r\n            });\r\n            return;\r\n        }\r\n        currentPosition += parseFloat(widthStep * step);\r\n        if (Math.round(parseFloat(currentPosition)) >= Math.round(parseFloat(maxStep))) {\r\n            currentPosition = parseFloat(maxStep);\r\n            $(slideContainer).css({\r\n                \"transform\": \"translateX(-\" + currentPosition + \"px)\"\r\n            });\r\n            return;\r\n        }\r\n        $(slideContainer).css({\r\n            \"transform\": \"translateX(-\" + currentPosition + \"px)\"\r\n        });\r\n    }\r\n\r\n    function initGallery() {\r\n        var windowSize = window.innerWidth;\r\n        if (windowSize >= 768) {\r\n            $(galleryWrap).show();\r\n            $(body).css({\r\n                \"overflow\": \"hidden\"\r\n            });\r\n\r\n            var $panzoom = $(galleryMainPhoto).panzoom();\r\n            $panzoom.parent().on('mousewheel.focal', function (e) {\r\n                e.preventDefault();\r\n                var delta = e.delta || e.originalEvent.wheelDelta;\r\n                var zoomOut = delta ? delta < 0 : e.originalEvent.deltaY > 0;\r\n                $panzoom.panzoom('zoom', zoomOut, {\r\n                    increment: 0.1,\r\n                    animate: false,\r\n                    focal: e\r\n                });\r\n            });\r\n\r\n\r\n            return initSlider(this);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function initSlider(event) {\r\n        console.log(event);\r\n        sliderItem = [];\r\n        (slideContainer).empty();\r\n        $(galleryPhotoList).empty();\r\n        for (var i = 0; i < articles.length; i++) {\r\n            console.log(articles[i]);\r\n            if (articles[i].logo) {\r\n                sliderItem.push(sliderItemRender(articles[i].logo.thumb_url, articles[i].id, articles[i]))\r\n            } else {\r\n                sliderItem.push(sliderItemRender('http://cdn.strikepro.ru/default_group.png', articles[i].id, articles[i]))\r\n            }\r\n        }\r\n        $(slideContainer).append(sliderItem);\r\n\r\n        widthStep = (parseFloat($(gallerySliderWrap).outerWidth() / 6)).toFixed(3);\r\n        maxStep = (parseFloat((sliderItem.length * widthStep) - (widthStep * 6))).toFixed(3);\r\n\r\n        currentPosition = 0;\r\n        $(slideContainer).css({\r\n            \"transform\": \"translateX(-\" + currentPosition + \"px)\"\r\n        });\r\n\r\n\r\n        $(\".slider__item\").each(function (index, element) {\r\n\r\n            if (parseInt($(element).attr('id')) === parseInt($(event).attr('id'))) {\r\n                $(element).addClass('active');\r\n                if (index + 1 > 6) {\r\n                    currentPosition = (parseFloat(((index + 1) * widthStep) - (widthStep * 6))).toFixed(3);\r\n                    $(slideContainer).css({\r\n                        \"transform\": \"translateX(-\" + currentPosition + \"px)\"\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        initDescription($(event).attr('id'));\r\n        initPhotos($(event).attr('id'));\r\n\r\n        $(\".slider__item\").on('click', function (e) {\r\n            e.preventDefault();\r\n            initDescription($(this).attr('id'));\r\n            initPhotos($(this).attr('id'));\r\n            $(\".slider__item\").removeClass('active');\r\n            $(this).addClass('active');\r\n\r\n            $(galleryMainPhoto).css({\r\n                'transform': 'none'\r\n            })\r\n        })\r\n    }\r\n\r\n    function initDescription(id) {\r\n        for (var i = 0; i < articles.length; i++) {\r\n            if (articles[i].id === parseInt(id)) {\r\n                descriptionRender(articles[i].features);\r\n            }\r\n        }\r\n    }\r\n\r\n    function initPhotos(id) {\r\n        $(galleryPhotoList).empty();\r\n        for (var i = 0; i < articles.length; i++) {\r\n            if (articles[i].id === parseInt(id)) {\r\n                console.log(articles[i]);\r\n                initGalleryMainPhoto(articles[i].id);\r\n                gelleryPhotoRender(articles[i].head_images);\r\n            }\r\n        }\r\n    }\r\n\r\n    function initGalleryMainPhoto(id) {\r\n        console.log(id);\r\n        console.log(currentPhoto);\r\n        for (var i = 0; i < articles.length; i++) {\r\n            if (articles[i].id === parseInt(id)) {\r\n\r\n                $(galleryMainPhoto).attr('src', articles[i].logo.original_url);\r\n                $(galleryMainTitle).text(articles[i].fullname);\r\n            }\r\n        }\r\n    }\r\n\r\n    function init() {\r\n        try {\r\n            var windowSize = window.innerWidth;\r\n            $(colorTable).empty();\r\n            $(colorTable).after(\"<div class='colorTable _mobile'></div>\");\r\n            $(\".left\").on(\"click\", leftMove);\r\n            $(\".right\").on(\"click\", rightMove);\r\n\r\n            for (var i = 0; i < articles.length; i++) {\r\n                if (articles[i].logo) {\r\n                    colorTableItem.push(colorTableItemRender(articles[i].id, articles[i].logo.thumb_url ? articles[i].logo.thumb_url : 'http://cdn.strikepro.ru/default_group.png', articles[i]));\r\n                } else {\r\n                    colorTableItem.push(colorTableItemRender(articles[i].id, 'http://cdn.strikepro.ru/default_group.png', articles[i]));\r\n                }\r\n            }\r\n            $(colorTable).append(colorTableItem);\r\n            $('.colorTable._mobile').append(colorTableItem);\r\n            $('.colorTable._desctop .colorTable__item').on('click', initGallery);\r\n            if (windowSize >= 768) {\r\n\r\n            } else {\r\n                colorTable_item_slider();\r\n            }\r\n        } catch (err) {\r\n            throw new Error(err);\r\n        }\r\n    }\r\n\r\n    function colorTable_item_slider() {\r\n        var colorTableItemMobile = $('.colorTable._mobile .colorTable__item');\r\n        var colorTableItemMobileLength = colorTableItemMobile.length;\r\n        for (var i = 0; i < colorTableItemMobileLength; i++) {\r\n            var slides = [];\r\n            var classNav = \".custom-navigation-\" + i + \" a\";\r\n            var photos = articles[i].head_images;\r\n            console.log(photos);\r\n            var photosLength = photos ? photos.length : 1;\r\n            console.log(photosLength);\r\n            if (photosLength === 1) continue;\r\n\r\n            var sliderWrap = document.createElement('div'),\r\n                sliderList = document.createElement('ul');\r\n            $(sliderWrap).addClass('slider-' + i);\r\n            $(sliderList).addClass('slides');\r\n\r\n            for (var a = 0; a < photosLength; a++) {\r\n                var li = document.createElement('li'),\r\n                    img = document.createElement('img'),\r\n                    span = document.createElement('span');\r\n                $(span).text(photos[a].title);\r\n                $(img).attr('src', photos[a].original_url);\r\n                $(li).append(img);\r\n                $(li).append(span);\r\n                slides.push(li)\r\n            }\r\n\r\n            $(sliderList).append(slides);\r\n            $(sliderWrap).append(sliderList);\r\n            $(sliderWrap).append('<div class=\"flex-direction-nav ' + \"custom-navigation-\" + i + '\">' +\r\n                '<a href=\"#\" class=\"flex-prev\">' +\r\n                '<svg><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#svg_arrow\" class=\"caret__arrow\"></use></svg>' +\r\n                '</a>' +\r\n                '<a href=\"#\" class=\"flex-next\">' +\r\n                '<svg><use xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"#svg_arrow\" class=\"caret__arrow\"></use></svg>' +\r\n                '</a>' +\r\n                '</div>');\r\n\r\n\r\n            $(colorTableItemMobile[i]).empty();\r\n            $(colorTableItemMobile[i]).append(sliderWrap);\r\n\r\n            $(sliderWrap).flexslider({\r\n                animation: \"slide\",\r\n                slideshow: false,\r\n                touch: true,\r\n                directionNav: true,\r\n                controlNav: false,\r\n                customDirectionNav: $(classNav)\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n\r\n    addEventListener(\"keydown\", function (event) {\r\n        var active = $('.colorTable__gallery--wrapper').css('display');\r\n        if (active === 'block') {\r\n\r\n            if (event.which === 37) { //left\r\n                leftMove(event);\r\n            }\r\n            if (event.which === 39) { // right\r\n                rightMove(event);\r\n            }\r\n            if (event.which === 38) { // top\r\n                $('.colorTable__gallery--variation').scrollTop($('.colorTable__gallery--variation').scrollTop() - 10);\r\n            }\r\n            if (event.which === 40) { // bottom\r\n                $('.colorTable__gallery--variation').scrollTop($('.colorTable__gallery--variation').scrollTop() + 10);\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n    try {\r\n        init();\r\n    } catch (err) {\r\n        console.log(err)\r\n    }\r\n\r\n    $(window).resize(function () {\r\n        var windowSize = window.innerWidth;\r\n        if (windowSize >= 992) {\r\n            widthStep = (parseFloat($(gallerySliderWrap).outerWidth() / 6)).toFixed(3);\r\n            maxStep = (parseFloat((sliderItem.length * widthStep) - (widthStep * 6))).toFixed(3);\r\n            currentPosition = 0;\r\n            $(slideContainer).css({\r\n                \"transform\": \"translateX(0px)\"\r\n            });\r\n        } else {\r\n            colorTable_item_slider();\r\n        }\r\n    });\r\n\r\n});\r\n\r\n\r\n$(document).ready(function () {\r\n    $(\".js-btn3D\").on(\"click\", function () {\r\n        console.log('click')\r\n        var img3D = $('#reel-image');\r\n        $(img3D).reel({\r\n            loops: true,\r\n            speed: 0.5,\r\n            frames: 6,\r\n            revolution: 100,\r\n            images: \"http://test.vostrel.net/jquery.reel/example/object-movie-non-looping-sequence/green/#.png\"\r\n        });\r\n\r\n        $(\".img_2d\").hide();\r\n        $('#reel-image-reel').show();\r\n        $(img3D).show()\r\n    });\r\n    $(\".product__sliderImg ul li a\").on('click', function (event) {\r\n        console.log('click')\r\n\r\n        var img2D = $(\".img_2d\");\r\n        var img3D = $('#reel-image');\r\n        event.preventDefault();\r\n        $(img2D).show();\r\n        $(img2D).attr(\"src\", $(this).attr(\"href\"));\r\n        $(img3D).hide();\r\n        $('#reel-image-reel').hide();\r\n    });\r\n    $(window).resize(function () {\r\n        var k = 500 / 304,\r\n            productStand = $('.product__stand'),\r\n            w = screen.width;\r\n\r\n        if (w < 500) {\r\n            $(productStand).height($(productStand).width() / k);\r\n        }\r\n    });\r\n\r\n\r\n    //TODO: ШАПКА СТРАНИЦЫ ПРОДУКТА\r\n    var HeaderProductWrapper = $('.header-product'),\r\n        HeaderProductTitle = $('.header-product__title'),\r\n        HeaderProductImage = $('.header-product__image img'),\r\n        HeaderProductNav = $('.header-product__nav'),\r\n        SectionTitleList = $('h4.title__xs'),\r\n        HeaderProductMenuList = [];\r\n\r\n    function renderMenuItem(link, content) {\r\n        return ('<li class=\"header-product__item\"><a href=\"#' + link + '\" class=\"header-product__link\">' + content + '</a></li>')\r\n    }\r\n\r\n    function init() {\r\n        $(SectionTitleList).each(function (index, element) {\r\n            var id = 'product-section-id-' + index,\r\n                content = $(element).text();\r\n            $(element).attr(\"id\", id);\r\n            HeaderProductMenuList.push(renderMenuItem(id, content));\r\n        });\r\n        $(HeaderProductNav).append(HeaderProductMenuList);\r\n        $(HeaderProductImage).attr('src', $('.product__stand--img .img_2d').attr('src'));\r\n        $(HeaderProductTitle).text($('.product__title h1').text());\r\n\r\n        //TODO: Инициализация обработчика скрола\r\n        initScroll(window);\r\n        initAncorHeaderProduct();\r\n    }\r\n\r\n\r\n    init();\r\n\r\n    function initAncorHeaderProduct() {\r\n        $('.header-product__nav .headerNav__item').on(\"click\", \"a\", function (event) {\r\n            //отменяем стандартную обработку нажатия по ссылке\r\n            event.preventDefault();\r\n            $('.header-product__nav .headerNav__item').each(function (index, element) {\r\n                $(element).removeClass('active');\r\n            });\r\n            //забираем идентификатор бока с атрибута href\r\n            var id = $(this).attr('href'),\r\n\r\n                //узнаем высоту от начала страницы до блока на который ссылается якорь\r\n                top = $(id).offset().top;\r\n            $(this).closest('.headerNav__item').addClass('active');\r\n            //анимируем переход на расстояние - top за 1500 мс\r\n            $('body,html').animate({scrollTop: top}, 225);\r\n        });\r\n    }\r\n\r\n    function HeaderProductMenuToggle() {\r\n        var list = $('.header-product__nav .headerNav__item');\r\n\r\n        $(SectionTitleList).each(function (index, element) {\r\n\r\n            if ($(element).offset().top - 200 < window.scrollY) {\r\n                $(list).each(function (index, element) {\r\n                    $(element).removeClass('active');\r\n                });\r\n                $(list[index]).addClass('active')\r\n            }\r\n        });\r\n    }\r\n\r\n    function HeaderProductToggle() {\r\n        if (screen.width > 1023) {\r\n            if ($(\".img_2d\").offset().top + $(\".img_2d\").height() / 3 < window.scrollY) {\r\n\r\n                $('.header__top').css({top: '-150px'});\r\n                $('.header-product').css({top: '0'});\r\n            } else {\r\n                $('.header__top').css({top: '0'});\r\n                $('.header-product').css({top: '-150px'});\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    // $(\".img_2d\").offset()\r\n\r\n    function initScroll(elem) {\r\n        if (elem.addEventListener) {\r\n            if ('onwheel' in document) {\r\n                // IE9+, FF17+, Ch31+\r\n                elem.addEventListener(\"wheel\", onWheel);\r\n            } else if ('onmousewheel' in document) {\r\n                // устаревший вариант события\r\n                elem.addEventListener(\"mousewheel\", onWheel);\r\n            } else {\r\n                // Firefox < 17\r\n                elem.addEventListener(\"MozMousePixelScroll\", onWheel);\r\n            }\r\n        } else { // IE8-\r\n            elem.attachEvent(\"onmousewheel\", onWheel);\r\n        }\r\n\r\n        function onWheel(e) {\r\n            e = e || window.event;\r\n\r\n            // wheelDelta не дает возможность узнать количество пикселей\r\n            var delta = e.deltaY || e.detail || e.wheelDelta;\r\n\r\n            HeaderProductToggle();\r\n            HeaderProductMenuToggle();\r\n        }\r\n    }\r\n\r\n});\r\n\r\n\r\n$(document).ready(function () {\r\n\r\n    var productDescription = $('.js-product-description');\r\n    var productDescriptionHeight = '';\r\n\r\n    function init() {\r\n        productDescriptionHeight = $(productDescription).innerHeight();\r\n\r\n        var prevElemHeight = $(productDescription).innerWidth() / 2;\r\n\r\n        if (prevElemHeight > productDescriptionHeight) {\r\n            $(this).outerHeight('auto');\r\n            $(this).removeClass('product-desc__disable');\r\n            return\r\n        }\r\n\r\n        $(productDescription).addClass('product-desc__disable');\r\n        $(productDescription).innerHeight(prevElemHeight);\r\n        $(productDescription).on('click', function () {\r\n            if ($(this).hasClass('product-desc__disable')) {\r\n                $(this).outerHeight('auto');\r\n                $(this).removeClass('product-desc__disable')\r\n            } else {\r\n                // $(this).outerHeight(prevElemHeight);\r\n                // $(this).addClass('product-desc__disable')\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n    init();\r\n    $(window).resize(function () {\r\n        init();\r\n    })\r\n});\r\n\r\n"],"file":"productSlider.js"}